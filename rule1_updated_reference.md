
## RULE 1
- If a provider's specialty is internal medicine, family practice, general practice, or geriatric practice, AND (provider is not indicated as a PCP) then suppress from Directory. 	

```sql 
REPLACE PROCEDURE HSLABCORNERSTONE.RULE_1_Spayer_NPI_SPECIALTIES ()
SQL SECURITY INVOKER
MAIN: BEGIN
DELETE FROM HSLABCORNERSTONE.RULE_1_Spayer_NPI_SPECIALTIES_TB;
--DROP TABLE TEMP;
--DROP TABLE TEMP2;


CREATE VOLATILE TABLE temp AS (
SELECT DISTINCT p.NationalProviderID, sp.SpecialtyName, trim(concat(P.NationalProviderID, '-', sp.SpecialtyName)) AS sub_concat
FROM   PROVIDERDATASERVICE_CORE_V.PROV_SPAYER_practitioners p
       LEFT JOIN PROVIDERDATASERVICE_CORE_V.PROV_SPAYER_practitionertypes pt ON p.practitionertypeid = pt.practitionertypeid
       LEFT JOIN PROVIDERDATASERVICE_CORE_V.PROV_SPAYER_PRACTITIONERSPECIALTIES PRSP ON p.PractitionerID = PRSP.PractitionerID
       JOIN PROVIDERDATASERVICE_CORE_V.PROV_SPAYER_PRACTITIONERPRODUCTS PRPROD ON PRSP.PRACTITIONERID = PRPROD.PRACTITIONERID
       JOIN PROVIDERDATASERVICE_CORE_V.PROV_SPAYER_PRACTITIONERPRODUCTSPECIALTIES PRPRODSP
         ON PRPRODSP.PRACTITIONERPRODUCTRECID = PRPROD.PRACTITIONERPRODUCTRECID
       JOIN PROVIDERDATASERVICE_CORE_V.PROV_SPAYER_SPECIALTIES SP ON PRSP.SPECIALTYID = SP.SPECIALTYID
WHERE  PRSP.SPECIALTYID IN (1244642176, 1244642179, 1244642198, 1244642181) AND (PRPRODSP.SPECIALTYTYPEID <> '1244707445') AND
       trim                                                                                                                    (concat(P.NationalProviderID, '-', sp.SpecialtyName)
       ) NOT IN
         (SELECT DISTINCT trim(concat(P.NationalProviderID, '-', sp.SpecialtyName)) AS sub_concat1
          FROM   PROVIDERDATASERVICE_CORE_V.PROV_SPAYER_practitioners p
       LEFT JOIN PROVIDERDATASERVICE_CORE_V.PROV_SPAYER_practitionertypes pt ON p.practitionertypeid = pt.practitionertypeid
       LEFT JOIN PROVIDERDATASERVICE_CORE_V.PROV_SPAYER_PRACTITIONERSPECIALTIES PRSP ON p.PractitionerID = PRSP.PractitionerID
       JOIN PROVIDERDATASERVICE_CORE_V.PROV_SPAYER_PRACTITIONERPRODUCTS PRPROD ON PRSP.PRACTITIONERID = PRPROD.PRACTITIONERID
       JOIN PROVIDERDATASERVICE_CORE_V.PROV_SPAYER_PRACTITIONERPRODUCTSPECIALTIES PRPRODSP
         ON PRPRODSP.PRACTITIONERPRODUCTRECID = PRPROD.PRACTITIONERPRODUCTRECID
       JOIN PROVIDERDATASERVICE_CORE_V.PROV_SPAYER_SPECIALTIES SP ON PRSP.SPECIALTYID = SP.SPECIALTYID
          WHERE  PRSP.SPECIALTYID IN (1244642176, 1244642179, 1244642198, 1244642181) AND (PRPRODSP.SPECIALTYTYPEID = '1244707445'
       ))
         ) WITH DATA ON COMMIT PRESERVE ROWS;
               
                 
CREATE VOLATILE TABLE temp2 AS (
SELECT A.NPI, D.SpecialtyName, trim(concat (A.NPI, '-', D.SpecialtyName)) AS out_concat
FROM   HSLABCORNERSTONE.NPI_universe_20250506 A
       JOIN PROVIDERDATASERVICE_CORE_V.PROV_SPAYER_practitioners B ON A.NPI = B.NationalProviderID
       JOIN PROVIDERDATASERVICE_CORE_V.PROV_SPAYER_PRACTITIONERSPECIALTIES C ON B.PractitionerID = C.PractitionerID
       JOIN PROVIDERDATASERVICE_CORE_V.PROV_SPAYER_SPECIALTIES D ON D.SpecialtyId = C.SpecialtyId)

     WITH DATA ON COMMIT PRESERVE ROWS;

INSERT INTO HSLABCORNERSTONE.RULE_1_Spayer_NPI_SPECIALTIES_TB
SELECT DISTINCT npi,specialtyname FROM temp2 WHERE out_concat IN (SELECT sub_concat FROM temp );   

END;


CALL HSLABCORNERSTONE.RULE_1_Spayer_NPI_SPECIALTIES ()
```